---
layout: post
title: "response 对象"
date: 2018-05-03
tag: thinkPHP5
---

Response 对象用于动态响应客户端请示， 控制发送给用户的信息， 并将动态生成响应。 通常用于输出
数据给客户端或者浏览器

ThinkPHP5 的 Response 响应对象由 think\Response 类或者子类完成， 下面介绍下基本的用法

**自动输出**

大多数情况， 我们不需要关注 Response 对象本身， 只需要在控制器的操作方法中返回数据即可， 系统会根
据 default_return_type (html)和 default_ajax_return (json)配置决定响应输出的类型

默认的自动响应输出会自动判断是否 AJAX 请求， 如果是的话会自动输出 default_ajax_return 配置的
输出类型

```
<?php
namespace app\index\controller;
class index
{
  public function hello()
  {
    $data = ['name' => 'thinkphp','status' => '1'];
    return $data;
  }
}
由于 default_return_type = 'html' 所以访问页面输出结果为
不支持的数据类型输出：array

修改配置
default_return_type = 'json',
再次访问的输出结果为：
{'name':'thinkphp','status':'1'}

default_return_type = 'xml',
结果
<think>
  <name>thinkphp</name>
  <status>1</status>
</think>
```

**手动输出**

在必要的时候， 可以手动控制输出类型和参数， 这种方式较为灵活。 如果需要指定输出类型， 可以通过下面
的方式

```
<?php
namespace app\index\controller;
class Index
{
  public function hello()
  {
    $data = ['name' = 'thinkphp','status' => '1'];
    return json($data);
  }
}

无论配置参数如何设置 页面输出的结果为
{‘name’:'thinkphp','status':'1'}
```

默认的情况下发送的http状态码是 200 ， 如果需要返回其它的状态码， 可以使用

```
<?php
namespace app\index\controller;
class Index
{
  public function hello()
  {
    $data = ['name' => 'thinkphp', 'status' => '1'];
    return json($data, 201);
  }
}
```

或者发送更多的响应头信息

```
<?php
namespace app\index\controller;
class Index
{
  public function hello()
  {
    $data = ['name' => 'thinkphp', 'status' => '1'];
    return json($data, 201, ['Cache-control' => 'no-cache,must-revalidate']);
  }
}

也支持使用下面的方式

<?php
namespace app\index\controller;
class Index
{
  public function hello()
  {
    $data = ['name' => 'thinkphp', 'status' => '1'];
    return json($data)->code(201)->header(['Cache-control' => 'no-cache,must-revali
    date']);
  }
}

默认支持的输出类型包括： 输出类型 快捷方法

  渲染模板输出      view
  JSON输出         json
  JSONP输出        jsonp
  XML输出          xml
  页面重定向        redirect

```

所以， 同样的可以使用 xml 方法输出 XML 数据类型

```
<?php
namespace app\index\controller;
class Index
{
  public function hello()
  {
    $data = ['name' => 'thinkphp', 'status' => '1'];
    return xml($data, 201);
  }
}
```

**页面跳转**

如果需要进行一些简单的页面操作提示或者重定向， 可以引入 *traits\controller\Jump* ， 就可以使用
相关页面跳转和重定向方法

下面举一个简单的例子， 当页面传入name参数为thinkphp的时候， 跳转到欢迎
页面， 其它情况则跳转到一个guest页面

```
<?php
namespace app\index\controller;
class Index
{
  use \traits\controller\Jump;
  public function index($name = '')
  {
    if ('thinkphp' == $name){
      $this->success('欢迎','hello');
    }else{
      $this->error('错误name','guest');
    }
  }
  public function hello()
  {
    return 'hello,thinkphp!';
  }
  public function guest()
  {
    return 'hello,guest!';
  }
}
```
这里我们使用

`use \traits\controller\Jump;`

引入了一个 Jump trait， 这是 PHP5.4 版本的新特性， 如果你的控制器类是继承的
`\think\Controller` 的话， 系统已经自动为你引入了 `\traits\controller\Jump` ， 无需再次引
入

```
当我们访问
http://tp5.com
页面显示如图所示：
错误name
页面自动 跳转 等待时间：3 ... 2 ... 1
然后显示 Hello,Guest!

如果访问URL地址为
http://tp5.com?name=thinkphp
则页面显示如图所示：
欢迎
页面自动 跳转 等待时间：3 ... 2 ... 1
然后显示 Hello,ThinkPHP!
```

**页面重定向**

如果要进行页面重定向跳转， 可以使用

```
<?php
namespace app\index\controller;
class Index
{
  use \traits\controller\Jump;

  public function index($name='')
  {
    if ('thinkphp' == $name) {
      $this->redirect('http://thinkphp.cn');
    } else {
      $this->success('欢迎使用ThinkPHP','hello');
    }
  }
  public function hello()
  {
    return 'Hello,ThinkPHP!';
  }
}

当我们再次访问
http://tp5.com?name=thinkphp
就会重定向到ThinkPHP官网 http://thinkphp.cn
redirect 方法默认使用 302 跳转， 如不需要可以使用第二个参数进行301跳转
$this->redirect('http://thinkphp.cn',301);

在任何时候（ 即使没有引入Jump trait的话）
我们可以使用系统提供的助手函数redirect函数进行重定向

namespace app\index\controller;
class Index
{
  public function index($name='')
  {
    if ('thinkphp' == $name) {
      return redirect('http://thinkphp.cn');
    } else {
      return 'Hello,ThinkPHP!';
    }
  }
}
```
